<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë…¸ë˜ ë§ì¶”ê¸°</title>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="//unpkg.com/bootstrap@4/dist/css/bootstrap.min.css">
    <script src='//unpkg.com/popper.js@1/dist/umd/popper.min.js'></script>
    <script src='//unpkg.com/bootstrap@4/dist/js/bootstrap.min.js'></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <link rel="stylesheet" href="//unpkg.com/bootstrap@4/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="custom.css"/>
  </head>
  <body>
    <div class="container">
      <div class="progress">
        <div class="progress-bar bg-warning index-progress" role="progressbar" style="width: 0%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">1/10</div>
      </div>
      <div class="title text-center py-3">
        <h1>ë…¸ë˜ ë§ì¶”ê¸° ê²Œì„<br><font style="font-family: 'Montserrat', sans-serif; color: deeppink"> for <strong>MJ</strong></font></h1>
        <h2><span data-html="true" data-toggle="tooltip" data-placement="right" title="1. ì •ë‹µì…ë ¥ : ë„ì–´ì“°ê¸° ë° ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ìŒ<br>2. ì œí•œì‹œê°„ : 180ì´ˆ<br>3. ë‚œì´ë„ : 1ë‹¨ê³„ ~ 5ë‹¨ê³„, ë‚œì´ë„ì— ë”°ë¼ ì¬ìƒì‹œê°„ ê°ì†Œ<br>4. ê±´ë„ˆë›°ê¸° ê¸°ëŠ¥ : ëª¨ë¥´ëŠ” ë…¸ë˜ ìŠ¤í‚µ ê°€ëŠ¥<br>5. ê²Œì„ ê²°ê³¼ : ì‹œê°„ì´ ì´ˆê³¼ë˜ê±°ë‚˜ 10ë¬¸ì œ ì§„í–‰ í›„ í™•ì¸"><i class="fas fa-exclamation-circle"></i> ê²Œì„ë°©ë²•</span></h2>
      </div>

      <div class="pass-button-container py-1">
        <button type="button" class="btn btn-primary pass-button" disabled>ê±´ë„ˆë›°ê¸°</button>
      </div>

      <div class="level-container text-center py-3">
        <h3>ë‚œì´ë„</h3>
        <div class="row justify-content-center">
          <div class="level">
            <i class="fas fa-3x fa-star"></i>
            <i class="fas fa-3x fa-star"></i>
          </div>
          <div class="level">
            <i class="fas fa-3x fa-star"></i>
            <i class="fas fa-3x fa-star"></i>
          </div>
          <div class="level">
            <i class="fas fa-3x fa-star"></i>
            <i class="fas fa-3x fa-star"></i>
          </div>
          <div class="level">
            <i class="fas fa-3x fa-star"></i>
            <i class="fas fa-3x fa-star"></i>
          </div>
          <div class="level">
            <i class="fas fa-3x fa-star"></i>
            <i class="fas fa-3x fa-star"></i>
          </div>
        </div>
      </div>

      <div class="main-contents-container row justify-content-center">
        <img src="img/main.png" class="img-fluid mx-auto d-block" />
      </div>

      <div class="blob-container row justify-content-center py-1">
        <div class="blob-green text-center blob">
          <i class="fab fa-9x fa-itunes-note text-center" style="color: white;"></i>
        </div>
      </div>

      <div class="col-md-8 result-container">
        <div class="row">
          <div class="result-time">
            <h3>ë‚¨ì€ì‹œê°„</h3>
            <h1></h1>
          </div>
          <div class="result-score">
            <h3>ì •ë‹µ ìˆ˜</h3>
            <h1></h1>
          </div>
        </div>
        <div class="result-person mx-auto py-5 px-5">
          <h2>ë‹¹ì‹ ì˜ ì‹¤ë ¥ì€...</h2>
          <div class="profile py-5">
            <img src="" class="thumbnail">
            <h5 class="">ì´ìˆ˜ê·¼</h5>
          </div>
          <h4></h4>
        </div>
      </div>

      <div class="timer-container">
        <h1></h1>
      </div>

      <div class="player-container">
        <div id="player" style="display: none;"></div>
      </div>

      <div class="start-button-container py-3">
        <button type="button" class="btn btn-danger start-button">ë…¸ë˜ ë§ì¶”ê¸° ì‹œì‘í•˜ê¸°</button>
      </div>

      <div class="input-container py-1">
        <div class="input-group py-1">
          <div class="input-group-prepend">
            <span class="input-group-text" id="inputGroup-sizing-default">ì •ë‹µ</span>
          </div>
          <input type="text" class="form-control input-answer" aria-label="Default" aria-describedby="inputGroup-sizing-default">
          <div class="input-group-append button-answer">
            <button class="btn btn-success" type="button">í™•ì¸</button>
          </div>
        </div>
      </div>

      <div class="progress-container my-5">
        <h2>ì´ ì œí•œì‹œê°„ 180ì´ˆ</h2>
        <div class="progress">
          <div class="progress-bar bg-danger progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="">
            asdads
          </div>
        </div>
      </div>

    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>

      let time = 0;
      let num = 1;
      let level = 1;
      let grade = 0;
      let answer = "";
      let videoId = "";
      let start = 0;
      var player;
      let gameFlag = true;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          // height: '100%',
          // width: '100%',
          videoId: "",
          playerVars: {
            'autoplay': 0, // ìë™ì¬ìƒ
            'controls': 1, // ì¬ìƒì»¨íŠ¸ë¡¤ ë…¸ì¶œì—¬ë¶€
            'autohide': 0, // ì¬ìƒì»¨íŠ¸ë¡¤ì´ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§ˆì§€ì˜ ì—¬ë¶€
            'rel': 0, // ë™ì˜ìƒ ì¬ìƒì™„ë£Œ í›„ ìœ ì‚¬ë™ì˜ìƒ ë…¸ì¶œì—¬ë¶€
            'playsinline': 1, // í˜„í˜ì´ì§€ì—ì„œ ì¬ìƒ
            'wmode': 'transparent',
          }
        });
      }

      function onPlayerReady(event) {
        event.target.playVideo();
      }

      function endVideo() {
        player.pauseVideo();
        $(".blob-green").removeClass("blob");
        $(".fa-itunes-note").removeClass("note");
        $(".pass-button").prop('disabled', false);
      }

      let playSeconds = 0; // ìŒì•… ì¬ìƒì‹œê°„

      function startVideo() {
        player.loadVideoById(videoId, start);
        player.playVideo();
        setTimeout(endVideo, playSeconds);
      }

      let seconds = 3; // ìŒì•…ì¬ìƒ ì¹´ìš´íŠ¸ ë‹¤ìš´

      function playTimer() {
        if (!gameFlag) {
          return;
        }
        $(".timer-container h1").text(seconds);
        $(".timer-container").show();
        if (seconds==0) {      
          if (!gameFlag) {
            return;
          }
          clearInterval(timer);
          $(".timer-container").hide();
          $(".input-container").show();
          $(".progress-container").show();
          $(".blob-container").show();
          $(".pass-button-container").show();
          $(".blob-green").addClass("blob");
          $(".fa-itunes-note").addClass("note");
          $(".pass-button").prop('disabled', true);
        } else {
          seconds--;
        }
      }
      
      let gameSeconds = 180; // ê²Œì„ ì œí•œì‹œê°„

      function gameTimer() {
        $(".progress-container .progress-bar").text(gameSeconds +"ì´ˆ")
        if (gameSeconds==0) { 
          gameFlag = false;     
          clearInterval(gameTimer);
          player.pauseVideo();
          $(".level-container").hide();
          $(".title").hide();
          $(".blob-container").hide();
          $(".timer-container").hide();
          $(".start-button").hide();
          $(".progress-container").hide();
          $(".input-container").hide();
          $(".pass-button-container").hide();
          clearInterval(gTimer);
          $(".title h1").text("ì œí•œì‹œê°„ ì¢…ë£Œ!");
          $(".title h2").text("ê²°ê³¼ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.");
          $(".title").show();
          $(".start-button").text("ê²°ê³¼ë³´ê¸°");
          $(".start-button").show();
        } else {
          gameSeconds--;
        }
      }

      function endQuiz() {
        gameFlag = false;     
        clearInterval(gameTimer);
        player.pauseVideo();
        $(".level-container").hide();
        $(".title").hide();
        $(".blob-container").hide();
        $(".timer-container").hide();
        $(".start-button").hide();
        $(".progress-container").hide();
        $(".input-container").hide();
        $(".pass-button-container").hide();
        clearInterval(gTimer);
        $(".title h1").text("ëª¨ë“  ë…¸ë˜ë¥¼ ë“¤ì—ˆìŠµë‹ˆë‹¤.");
        $(".title h2").text("ê²°ê³¼ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.");
        $(".title").show();
        $(".start-button").text("ê²°ê³¼ë³´ê¸°");
        $(".start-button").show();
      }

      function loadPlayList() {
        $.ajax({
          type: "GET",
          dataType: "JSON",
          url: "https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=PLberYIcFsD68X_8bqTlwivUWTF4llVlBb&key=AIzaSyBFvVdPJQvzgcOBm1C1GLItXpOudlxZ6Cg",
          contentType: "application/json",
          success: function (jsonData) {
            // console.log(jsonData)
            let index = Math.floor(Math.random() * jsonData.items.length);
            let items = jsonData.items[index];
            videoId = items.snippet.resourceId.videoId;
            answer = items.snippet.title;
            // console.log(items);
            // console.log(items.snippet.title);
            // console.log(items.snippet.title.split("'")[1]);

            if ( answer.includes("'") ) {
              answer = answer.split("'")[1].replace(/ /gi, "");
            } else if ( answer.includes("â€˜") ) {
              answer = answer.split("â€˜")[1].split("â€™")[0].replace(/ /gi, "");
            } else if ( answer.includes("-") ) {
              answer = answer.split("-")[1].replace(/ /gi, "");
            } else if ( answer.includes("â€“") ) {
              answer = answer.split("â€“")[1].replace(/ /gi, "");
            } else if ( answer.includes("_") ) {
              answer = answer.split("_")[1].replace(/ /gi, "");
            } else {
              answer = answer.replace(/ /gi, "");
            }

            answer = answer.replace(/\!/g, "");
            answer = answer.replace(/\@/g, "");
            answer = answer.replace(/\#/g, "");
            answer = answer.replace(/\*/g, "");
            answer = answer.replace(/\&/g, "");

            if ( answer.includes("(") ) {
              answer = answer.split("(")[0];
            }
            answer = answer.toLowerCase();
            // console.log(answer);
          },
          complete: function (data) {

          },
          error: function (xhr, status, error) {
            console.log("ìœ íŠœë¸Œ ìš”ì²­ ì—ëŸ¬: " + error);
          },
        });
      }

      function checkAnswer() {
        if ( $(".input-answer").val().replace(/ /gi, "").toLowerCase()==answer ) {
          Swal.fire({
            icon: 'success',
            title: 'ì •ë‹µì…ë‹ˆë‹¤!',
            showConfirmButton: false,
            timer: 1500
          });
          grade++;
          $("#grade").val(grade);

          if ( num==10 ) {
            time = gameSeconds;
            endQuiz();
            return;
          }

          $(".input-container input").val("");
          $(".input-container").hide();
          $(".start-button").text("ë‹¤ìŒë¬¸ì œ");
          $(".start-button").show();
          $(".blob-container").hide();
          $(".pass-button-container").hide();
          level++;
          num++;

        } else {
          Swal.fire({
            icon: 'error',
            title: 'ì˜¤ë‹µì…ë‹ˆë‹¤.',
            text: 'ì œí•œì‹œê°„ ì•ˆì— ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”!',
            timer: 1500
          });
        }
      }

      $(".button-answer").on("click", function () {
        checkAnswer();
      });

      $(".input-answer").on("keyup",function (e) {
        if (e.keyCode == 13) {
          checkAnswer();
        }
      });

      // ê±´ë„ˆë›°ê¸°
      $(".pass-button").on("click", function() {
        Swal.fire({
          title: 'ì´ë²ˆ ê³¡ì„ í¬ê¸°í•˜ê³  <br>ë‹¤ìŒ ê³¡ìœ¼ë¡œ ê±´ë„ˆë›¸ê¹Œìš”?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'ê±´ë„ˆë›°ê¸°',
          cancelButtonText: 'ì·¨ì†Œ'
        }).then((result) => {
          if (result.isConfirmed) {
            if ( num==10 ) {
              endQuiz();
              return;
            }
            $(".pass-button-container").hide();
            $(".input-container input").val("");
            $(".input-container").hide();
            $(".start-button").text("ë‹¤ìŒë¬¸ì œ");
            $(".start-button").show();
            $(".blob-container").hide();
            num++;
          }
        })
      });

      // ì²« í™”ë©´ ì‹œì‘
      $(".start-button").on("click", function() {
        $(".title h2").text("");
        if ( $(".start-button").text()=="ê²°ê³¼ë³´ê¸°" ) {
          $(".start-button").hide();
          $(".title h1").text("ê²Œì„ ê²°ê³¼");
          if (gameSeconds!=0) {
            if (time >= 60) {
              if (time-60 >= 10) {
                $(".result-time h1").text("1 : " + time-60);
              } else {
                $(".result-time h1").text("1 : 0" + time-60);
              }
              
            } else {
              if (time>=10) {
                $(".result-time h1").text("0 : " + time);
              } else {
                $(".result-time h1").text("0 : 0" + time);
              }
            }
            
          } else {
            $(".result-time h1").text("0 : 00");
          }
          $(".result-score h1").text(grade + " / 10");
          
          if (grade>=10) {
            $(".profile img").attr("src", "img/ai.png");
            $(".profile h5").text("ê¸°ê³„");
            $(".result-person h4").text("ë†€ë¼ì›Œìš”.. AIì¸ê°€ìš”?");
          } else if (grade>=8) {
            $(".profile img").attr("src", "img/kim.png");
            $(".profile h5").text("ê¹€í¬ì² ");
            $(".result-person h4").text("êµ‰ì¥í•œ ì‹¤ë ¥ì´ì—ìš”!");
            $(".result-person h4").append("<br>â€œê³ ì„±ëŠ¥ ë…¸ë˜ ê²€ìƒ‰ê¸°!â€");
          } else if (grade>=6) {
            $(".profile img").attr("src", "img/mj.png");
            $(".profile h5").text("MJ");
            $(".result-person h4").text("ë›°ì–´ë‚œ ì‹¤ë ¥ì„ ê°–ê³  ìˆë„¤ìš”.");
            $(".result-person h4").append("<br>ì„œêµ¬ì— ê±°ì£¼í•˜ëŠ” ëŒ€ì¥ë¶€, ë…¸ë˜ ê²€ìƒ‰ í† ë¼!ğŸ§¡");
          } else if (grade>=4) {
            $(".profile img").attr("src", "img/lee.png");
            $(".profile h5").text("ì´ìˆ˜ê·¼");
            $(".result-person h4").text("ê´œì°®ì€ ì‹¤ë ¥ì´êµ°ìš”.");
            $(".result-person h4").append("<br>ì¸ê°„ë¯¸ ìˆëŠ” ë…¸ë˜ ê²€ìƒ‰ê¸°.");
          } else if (grade>=2) {
            $(".profile img").attr("src", "img/eun.png");
            $(".profile h5").text("ì€ì§€ì›");
            $(".result-person h4").text("ë‚˜ì˜ì§€ ì•Šì€ ì‹¤ë ¥ì´êµ°ìš”.");
          } else {
            $(".profile img").attr("src", "img/kang.png");
            $(".profile h5").text("ê°•í˜¸ë™");
            $(".result-person h4").text("ë¶í•œì—ì„œ ì˜¤ì…¨ë‚˜ìš”??");
            $(".result-person h4").append("<br>ë…¸ë˜ ì¢€ ë“£ê³  ì‚¬ì„¸ìš”!");
          }

          $(".result-container").fadeIn();
          return;
        }
        if ( $(".start-button").text()=="ë…¸ë˜ ë§ì¶”ê¸° ì‹œì‘í•˜ê¸°" ) {
          gTimer = setInterval(gameTimer, 1000);
          $(".progress-container .progress-bar").addClass("remain-time");
        }
        gameStart();
      });

      // ê²Œì„ì‹œì‘ ë²„íŠ¼
      function gameStart() {
        $(".index-progress").css("width", String(num / 10 * 100) + "%");
        $(".index-progress").text(num + "/10");
        seconds = 3;
        playSeconds = 10000 - (Math.round(level/2)*1750);
        $(".progress").show();
        start = Math.floor(Math.random() * 30) + 30
        loadPlayList();
        $(".title h1").text("ë¬¸ì œ " + num);
        $(".level-container").show();
        $(".level-container .row .level:nth-child(" + Math.round(level/2) + ") i:nth-child(1)").addClass("vanishIn");
        $(".main-contents-container").hide();
        $(".start-button").hide();
        timer = setInterval(playTimer, 1000);
        setTimeout(startVideo, 3500);
        console.log( grade );
      }

      $(function () {
        $('[data-toggle="tooltip"]').tooltip({
          animated: 'fade',
          placement: 'bottom',
          trigger: 'hover'
        });
      })

    </script>
  </body>
</html>
